import{_ as e}from"./Post.e17e6aa3.js";import{h as c,w as p,o as u,b as n,e as s}from"./vendor.a22b69d8.js";import"./app.25f8fd31.js";const l=n("div",{class:"markdown-body"},[n("p",{class:"my-1.25em last:mt-0 first:mb-0 leading-[1.75]"},"\u8FD9\u8282\u6211\u4EEC\u4E3B\u8981\u5BF9 Sentry \u6838\u5FC3\u6982\u5FF5\u7684\u57FA\u672C\u539F\u7406\u8FDB\u884C\u5206\u6790\uFF0C\u4E3B\u8981\u6709\u51E0\u70B9\uFF1A"),n("ul",{class:"my-1.25em list-disc list-inside px-2"},[n("li",{class:"my-0.5em"},"\u6536\u96C6\u9519\u8BEF\u4FE1\u606F"),n("li",{class:"my-0.5em"},"\u9762\u5305\u5C51\u5982\u4F55\u5DE5\u4F5C")]),n("h2",{id:"\u6536\u96C6\u9519\u8BEF\u4FE1\u606F",tabindex:"-1",class:"text-2xl font-bold mt-2em mb-1em next:mt-0"},[n("a",{class:"header-anchor text-sky-500 dark:text-sky-400 font-medium hover:underline",href:"#\u6536\u96C6\u9519\u8BEF\u4FE1\u606F","aria-hidden":"true"},"#"),s(" \u6536\u96C6\u9519\u8BEF\u4FE1\u606F")]),n("p",{class:"my-1.25em last:mt-0 first:mb-0 leading-[1.75]"},[s("\u6211\u4EEC\u5728\u524D\u7AEF\u6536\u96C6\u9519\u8BEF\uFF0C\u80AF\u5B9A\u79BB\u4E0D\u5F00 "),n("a",{href:"https://developer.mozilla.org/zh-CN/docs/Web/API/GlobalEventHandlers/onerror",class:"text-sky-500 dark:text-sky-400 font-medium hover:underline",target:"_blank",rel:"noopener"},"window.onerror"),s(" \u8FD9\u4E2A API\uFF0CSentry \u4E4B\u6240\u4EE5\u80FD\u591F\u81EA\u52A8\u6536\u96C6\u9519\u8BEF\u4FE1\u606F\uFF0C\u4E3B\u8981\u4E5F\u662F\u57FA\u4E8E\u8FD9\u4E2A API \u6765\u505A\u7684\u3002")]),n("p",{class:"my-1.25em last:mt-0 first:mb-0 leading-[1.75]"},[s("\u9996\u5148\u901A\u8FC7 "),n("code",null,"installGlobalHandler"),s(" \u8FD9\u4E2A\u51FD\u6570\u5BF9\u539F\u751F\u7684 "),n("code",null,"onerror"),s(" \u8FDB\u884C\u4E86\u91CD\u5199\uFF1A")]),n("pre",{class:"language-ts"},[n("code",{class:"language-ts"},[n("span",{class:"token keyword"},"this"),n("span",{class:"token punctuation"},"."),s("_global"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function-variable function"},"onerror"),s(),n("span",{class:"token operator"},"="),s(),n("span",{class:"token keyword"},"function"),n("span",{class:"token punctuation"},"("),s("msg"),n("span",{class:"token operator"},":"),s(),n("span",{class:"token builtin"},"any"),n("span",{class:"token punctuation"},","),s(" url"),n("span",{class:"token operator"},":"),s(),n("span",{class:"token builtin"},"any"),n("span",{class:"token punctuation"},","),s(" line"),n("span",{class:"token operator"},":"),s(),n("span",{class:"token builtin"},"any"),n("span",{class:"token punctuation"},","),s(" column"),n("span",{class:"token operator"},":"),s(),n("span",{class:"token builtin"},"any"),n("span",{class:"token punctuation"},","),s(" error"),n("span",{class:"token operator"},":"),s(),n("span",{class:"token builtin"},"any"),n("span",{class:"token punctuation"},")"),n("span",{class:"token operator"},":"),s(),n("span",{class:"token builtin"},"boolean"),s(),n("span",{class:"token punctuation"},"{"),s(`
      `),n("span",{class:"token keyword"},"const"),s(" currentHub "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token function"},"getCurrentHub"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
      `),n("span",{class:"token keyword"},"const"),s(" hasIntegration "),n("span",{class:"token operator"},"="),s(" currentHub"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"getIntegration"),n("span",{class:"token punctuation"},"("),s("GlobalHandlers"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
      `),n("span",{class:"token keyword"},"const"),s(" isFailedOwnDelivery "),n("span",{class:"token operator"},"="),s(" error "),n("span",{class:"token operator"},"&&"),s(" error"),n("span",{class:"token punctuation"},"."),s("__sentry_own_request__ "),n("span",{class:"token operator"},"==="),s(),n("span",{class:"token boolean"},"true"),n("span",{class:"token punctuation"},";"),s(`

      `),n("span",{class:"token keyword"},"if"),s(),n("span",{class:"token punctuation"},"("),n("span",{class:"token operator"},"!"),s("hasIntegration "),n("span",{class:"token operator"},"||"),s(),n("span",{class:"token function"},"shouldIgnoreOnError"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"||"),s(" isFailedOwnDelivery"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
        `),n("span",{class:"token keyword"},"if"),s(),n("span",{class:"token punctuation"},"("),s("self"),n("span",{class:"token punctuation"},"."),s("_oldOnErrorHandler"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
          `),n("span",{class:"token keyword"},"return"),s(" self"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"_oldOnErrorHandler"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"apply"),n("span",{class:"token punctuation"},"("),n("span",{class:"token keyword"},"this"),n("span",{class:"token punctuation"},","),s(" arguments"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
        `),n("span",{class:"token punctuation"},"}"),s(`
        `),n("span",{class:"token keyword"},"return"),s(),n("span",{class:"token boolean"},"true"),n("span",{class:"token punctuation"},";"),s(`
      `),n("span",{class:"token punctuation"},"}"),s(`

      `),n("span",{class:"token keyword"},"const"),s(" client "),n("span",{class:"token operator"},"="),s(" currentHub"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"getClient"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
      `),n("span",{class:"token keyword"},"const"),s(" event "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token function"},"isPrimitive"),n("span",{class:"token punctuation"},"("),s("error"),n("span",{class:"token punctuation"},")"),s(`
        `),n("span",{class:"token operator"},"?"),s(" self"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"_eventFromIncompleteOnError"),n("span",{class:"token punctuation"},"("),s("msg"),n("span",{class:"token punctuation"},","),s(" url"),n("span",{class:"token punctuation"},","),s(" line"),n("span",{class:"token punctuation"},","),s(" column"),n("span",{class:"token punctuation"},")"),s(`
        `),n("span",{class:"token operator"},":"),s(" self"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"_enhanceEventWithInitialFrame"),n("span",{class:"token punctuation"},"("),s(`
            `),n("span",{class:"token function"},"eventFromUnknownInput"),n("span",{class:"token punctuation"},"("),s("error"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token keyword"},"undefined"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token punctuation"},"{"),s(`
              attachStacktrace`),n("span",{class:"token operator"},":"),s(" client "),n("span",{class:"token operator"},"&&"),s(" client"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"getOptions"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},"."),s("attachStacktrace"),n("span",{class:"token punctuation"},","),s(`
              rejection`),n("span",{class:"token operator"},":"),s(),n("span",{class:"token boolean"},"false"),n("span",{class:"token punctuation"},","),s(`
            `),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},","),s(`
            url`),n("span",{class:"token punctuation"},","),s(`
            line`),n("span",{class:"token punctuation"},","),s(`
            column`),n("span",{class:"token punctuation"},","),s(`
          `),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`

      `),n("span",{class:"token function"},"addExceptionMechanism"),n("span",{class:"token punctuation"},"("),s("event"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token punctuation"},"{"),s(`
        handled`),n("span",{class:"token operator"},":"),s(),n("span",{class:"token boolean"},"false"),n("span",{class:"token punctuation"},","),s(`
        type`),n("span",{class:"token operator"},":"),s(),n("span",{class:"token string"},"'onerror'"),n("span",{class:"token punctuation"},","),s(`
      `),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`

      currentHub`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"captureEvent"),n("span",{class:"token punctuation"},"("),s("event"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token punctuation"},"{"),s(`
        originalException`),n("span",{class:"token operator"},":"),s(" error"),n("span",{class:"token punctuation"},","),s(`
      `),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`

      `),n("span",{class:"token keyword"},"if"),s(),n("span",{class:"token punctuation"},"("),s("self"),n("span",{class:"token punctuation"},"."),s("_oldOnErrorHandler"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
        `),n("span",{class:"token keyword"},"return"),s(" self"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"_oldOnErrorHandler"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"apply"),n("span",{class:"token punctuation"},"("),n("span",{class:"token keyword"},"this"),n("span",{class:"token punctuation"},","),s(" arguments"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
      `),n("span",{class:"token punctuation"},"}"),s(`

      `),n("span",{class:"token keyword"},"return"),s(),n("span",{class:"token boolean"},"true"),n("span",{class:"token punctuation"},";"),s(`
    `),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},";"),s(`
`)])]),n("p",{class:"my-1.25em last:mt-0 first:mb-0 leading-[1.75]"},[s("\u5F53\u7136\u4EC5\u4EC5\u4F9D\u8D56\u4E8E "),n("code",null,"window.onerror"),s(" \u8FD8\u4E0D\u591F\uFF0C\u6BD4\u5982\u8BF4 "),n("code",null,"Promise"),s(" \u91CC\u7684 "),n("code",null,"reject"),s(", \u5F53\u6CA1\u6709 reject \u5904\u7406\u5668\u7684\u65F6\u5019\uFF0C\u5219\u4F1A\u89E6\u53D1 "),n("a",{href:"https://developer.mozilla.org/zh-CN/docs/Web/Events/unhandledrejection",class:"text-sky-500 dark:text-sky-400 font-medium hover:underline",target:"_blank",rel:"noopener"},"unhandledrejection"),s(" \u4E8B\u4EF6\uFF0C\u56E0\u6B64\u9700\u8981\u7528\u5230\u8FD9\u4E2A API\uFF0CSentry \u4E5F\u5BF9\u5176\u8FDB\u884C\u4E86\u91CD\u5199\uFF1A")]),n("pre",{class:"language-js"},[n("code",{class:"language-js"},[n("span",{class:"token keyword"},"this"),n("span",{class:"token punctuation"},"."),s("_global"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function-variable function"},"onunhandledrejection"),s(),n("span",{class:"token operator"},"="),s(),n("span",{class:"token keyword"},"function"),n("span",{class:"token punctuation"},"("),n("span",{class:"token parameter"},[s("e"),n("span",{class:"token operator"},":"),s(" any")]),n("span",{class:"token punctuation"},")"),n("span",{class:"token operator"},":"),s(" boolean "),n("span",{class:"token punctuation"},"{"),s(`
      `),n("span",{class:"token keyword"},"let"),s(" error "),n("span",{class:"token operator"},"="),s(" e"),n("span",{class:"token punctuation"},";"),s(`
      `),n("span",{class:"token keyword"},"try"),s(),n("span",{class:"token punctuation"},"{"),s(`
        error `),n("span",{class:"token operator"},"="),s(" e "),n("span",{class:"token operator"},"&&"),s(),n("span",{class:"token string"},"'reason'"),s(),n("span",{class:"token keyword"},"in"),s(" e "),n("span",{class:"token operator"},"?"),s(" e"),n("span",{class:"token punctuation"},"."),s("reason "),n("span",{class:"token operator"},":"),s(" e"),n("span",{class:"token punctuation"},";"),s(`
      `),n("span",{class:"token punctuation"},"}"),s(),n("span",{class:"token keyword"},"catch"),s(),n("span",{class:"token punctuation"},"("),s("_oO"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
        `),n("span",{class:"token comment"},"// no-empty"),s(`
      `),n("span",{class:"token punctuation"},"}"),s(`

      `),n("span",{class:"token keyword"},"const"),s(" currentHub "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token function"},"getCurrentHub"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
      `),n("span",{class:"token keyword"},"const"),s(" hasIntegration "),n("span",{class:"token operator"},"="),s(" currentHub"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"getIntegration"),n("span",{class:"token punctuation"},"("),s("GlobalHandlers"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
      `),n("span",{class:"token keyword"},"const"),s(" isFailedOwnDelivery "),n("span",{class:"token operator"},"="),s(" error "),n("span",{class:"token operator"},"&&"),s(" error"),n("span",{class:"token punctuation"},"."),s("__sentry_own_request__ "),n("span",{class:"token operator"},"==="),s(),n("span",{class:"token boolean"},"true"),n("span",{class:"token punctuation"},";"),s(`

      `),n("span",{class:"token keyword"},"if"),s(),n("span",{class:"token punctuation"},"("),n("span",{class:"token operator"},"!"),s("hasIntegration "),n("span",{class:"token operator"},"||"),s(),n("span",{class:"token function"},"shouldIgnoreOnError"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"||"),s(" isFailedOwnDelivery"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
        `),n("span",{class:"token keyword"},"if"),s(),n("span",{class:"token punctuation"},"("),s("self"),n("span",{class:"token punctuation"},"."),s("_oldOnUnhandledRejectionHandler"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
          `),n("span",{class:"token keyword"},"return"),s(" self"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"_oldOnUnhandledRejectionHandler"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"apply"),n("span",{class:"token punctuation"},"("),n("span",{class:"token keyword"},"this"),n("span",{class:"token punctuation"},","),s(" arguments"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
        `),n("span",{class:"token punctuation"},"}"),s(`
        `),n("span",{class:"token keyword"},"return"),s(),n("span",{class:"token boolean"},"true"),n("span",{class:"token punctuation"},";"),s(`
      `),n("span",{class:"token punctuation"},"}"),s(`

      `),n("span",{class:"token keyword"},"const"),s(" client "),n("span",{class:"token operator"},"="),s(" currentHub"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"getClient"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
      `),n("span",{class:"token keyword"},"const"),s(" event "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token function"},"isPrimitive"),n("span",{class:"token punctuation"},"("),s("error"),n("span",{class:"token punctuation"},")"),s(`
        `),n("span",{class:"token operator"},"?"),s(" self"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"_eventFromIncompleteRejection"),n("span",{class:"token punctuation"},"("),s("error"),n("span",{class:"token punctuation"},")"),s(`
        `),n("span",{class:"token operator"},":"),s(),n("span",{class:"token function"},"eventFromUnknownInput"),n("span",{class:"token punctuation"},"("),s("error"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token keyword"},"undefined"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token punctuation"},"{"),s(`
            attachStacktrace`),n("span",{class:"token operator"},":"),s(" client "),n("span",{class:"token operator"},"&&"),s(" client"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"getOptions"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},"."),s("attachStacktrace"),n("span",{class:"token punctuation"},","),s(`
            rejection`),n("span",{class:"token operator"},":"),s(),n("span",{class:"token boolean"},"true"),n("span",{class:"token punctuation"},","),s(`
          `),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`

      event`),n("span",{class:"token punctuation"},"."),s("level "),n("span",{class:"token operator"},"="),s(" Severity"),n("span",{class:"token punctuation"},"."),s("Error"),n("span",{class:"token punctuation"},";"),s(`

      `),n("span",{class:"token function"},"addExceptionMechanism"),n("span",{class:"token punctuation"},"("),s("event"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token punctuation"},"{"),s(`
        handled`),n("span",{class:"token operator"},":"),s(),n("span",{class:"token boolean"},"false"),n("span",{class:"token punctuation"},","),s(`
        type`),n("span",{class:"token operator"},":"),s(),n("span",{class:"token string"},"'onunhandledrejection'"),n("span",{class:"token punctuation"},","),s(`
      `),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`

      currentHub`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"captureEvent"),n("span",{class:"token punctuation"},"("),s("event"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token punctuation"},"{"),s(`
        originalException`),n("span",{class:"token operator"},":"),s(" error"),n("span",{class:"token punctuation"},","),s(`
      `),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`

      `),n("span",{class:"token keyword"},"if"),s(),n("span",{class:"token punctuation"},"("),s("self"),n("span",{class:"token punctuation"},"."),s("_oldOnUnhandledRejectionHandler"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
        `),n("span",{class:"token keyword"},"return"),s(" self"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"_oldOnUnhandledRejectionHandler"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"apply"),n("span",{class:"token punctuation"},"("),n("span",{class:"token keyword"},"this"),n("span",{class:"token punctuation"},","),s(" arguments"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
      `),n("span",{class:"token punctuation"},"}"),s(`

      `),n("span",{class:"token keyword"},"return"),s(),n("span",{class:"token boolean"},"true"),n("span",{class:"token punctuation"},";"),s(`
    `),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},";"),s(`
`)])]),n("p",{class:"my-1.25em last:mt-0 first:mb-0 leading-[1.75]"},[n("code",null,"installGlobalHandler.ts"),s(" \u8FD8\u5728\u4E8B\u4EF6\u7684 exception \u4E0A\u6DFB\u52A0 stacktrace \u5C5E\u6027\uFF0C\u6765\u5B58\u653E\u6536\u96C6\u5230\u7684\u5806\u6808\u8DDF\u8E2A\u8BB0\u5F55\uFF1A")]),n("pre",{class:"language-ts"},[n("code",{class:"language-ts"},[s("  "),n("span",{class:"token keyword"},"private"),s(),n("span",{class:"token function"},"_enhanceEventWithInitialFrame"),n("span",{class:"token punctuation"},"("),s("event"),n("span",{class:"token operator"},":"),s(" Event"),n("span",{class:"token punctuation"},","),s(" url"),n("span",{class:"token operator"},":"),s(),n("span",{class:"token builtin"},"any"),n("span",{class:"token punctuation"},","),s(" line"),n("span",{class:"token operator"},":"),s(),n("span",{class:"token builtin"},"any"),n("span",{class:"token punctuation"},","),s(" column"),n("span",{class:"token operator"},":"),s(),n("span",{class:"token builtin"},"any"),n("span",{class:"token punctuation"},")"),n("span",{class:"token operator"},":"),s(" Event "),n("span",{class:"token punctuation"},"{"),s(`
    event`),n("span",{class:"token punctuation"},"."),s("exception "),n("span",{class:"token operator"},"="),s(" event"),n("span",{class:"token punctuation"},"."),s("exception "),n("span",{class:"token operator"},"||"),s(),n("span",{class:"token punctuation"},"{"),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},";"),s(`
    event`),n("span",{class:"token punctuation"},"."),s("exception"),n("span",{class:"token punctuation"},"."),s("values "),n("span",{class:"token operator"},"="),s(" event"),n("span",{class:"token punctuation"},"."),s("exception"),n("span",{class:"token punctuation"},"."),s("values "),n("span",{class:"token operator"},"||"),s(),n("span",{class:"token punctuation"},"["),n("span",{class:"token punctuation"},"]"),n("span",{class:"token punctuation"},";"),s(`
    event`),n("span",{class:"token punctuation"},"."),s("exception"),n("span",{class:"token punctuation"},"."),s("values"),n("span",{class:"token punctuation"},"["),n("span",{class:"token number"},"0"),n("span",{class:"token punctuation"},"]"),s(),n("span",{class:"token operator"},"="),s(" event"),n("span",{class:"token punctuation"},"."),s("exception"),n("span",{class:"token punctuation"},"."),s("values"),n("span",{class:"token punctuation"},"["),n("span",{class:"token number"},"0"),n("span",{class:"token punctuation"},"]"),s(),n("span",{class:"token operator"},"||"),s(),n("span",{class:"token punctuation"},"{"),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},";"),s(`
    event`),n("span",{class:"token punctuation"},"."),s("exception"),n("span",{class:"token punctuation"},"."),s("values"),n("span",{class:"token punctuation"},"["),n("span",{class:"token number"},"0"),n("span",{class:"token punctuation"},"]"),n("span",{class:"token punctuation"},"."),s("stacktrace "),n("span",{class:"token operator"},"="),s(" event"),n("span",{class:"token punctuation"},"."),s("exception"),n("span",{class:"token punctuation"},"."),s("values"),n("span",{class:"token punctuation"},"["),n("span",{class:"token number"},"0"),n("span",{class:"token punctuation"},"]"),n("span",{class:"token punctuation"},"."),s("stacktrace "),n("span",{class:"token operator"},"||"),s(),n("span",{class:"token punctuation"},"{"),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},";"),s(`
    event`),n("span",{class:"token punctuation"},"."),s("exception"),n("span",{class:"token punctuation"},"."),s("values"),n("span",{class:"token punctuation"},"["),n("span",{class:"token number"},"0"),n("span",{class:"token punctuation"},"]"),n("span",{class:"token punctuation"},"."),s("stacktrace"),n("span",{class:"token punctuation"},"."),s("frames "),n("span",{class:"token operator"},"="),s(" event"),n("span",{class:"token punctuation"},"."),s("exception"),n("span",{class:"token punctuation"},"."),s("values"),n("span",{class:"token punctuation"},"["),n("span",{class:"token number"},"0"),n("span",{class:"token punctuation"},"]"),n("span",{class:"token punctuation"},"."),s("stacktrace"),n("span",{class:"token punctuation"},"."),s("frames "),n("span",{class:"token operator"},"||"),s(),n("span",{class:"token punctuation"},"["),n("span",{class:"token punctuation"},"]"),n("span",{class:"token punctuation"},";"),s(`

    `),n("span",{class:"token keyword"},"const"),s(" colno "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token function"},"isNaN"),n("span",{class:"token punctuation"},"("),n("span",{class:"token function"},"parseInt"),n("span",{class:"token punctuation"},"("),s("column"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token number"},"10"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"?"),s(),n("span",{class:"token keyword"},"undefined"),s(),n("span",{class:"token operator"},":"),s(" column"),n("span",{class:"token punctuation"},";"),s(`
    `),n("span",{class:"token keyword"},"const"),s(" lineno "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token function"},"isNaN"),n("span",{class:"token punctuation"},"("),n("span",{class:"token function"},"parseInt"),n("span",{class:"token punctuation"},"("),s("line"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token number"},"10"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"?"),s(),n("span",{class:"token keyword"},"undefined"),s(),n("span",{class:"token operator"},":"),s(" line"),n("span",{class:"token punctuation"},";"),s(`
    `),n("span",{class:"token keyword"},"const"),s(" filename "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token function"},"isString"),n("span",{class:"token punctuation"},"("),s("url"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"&&"),s(" url"),n("span",{class:"token punctuation"},"."),s("length "),n("span",{class:"token operator"},">"),s(),n("span",{class:"token number"},"0"),s(),n("span",{class:"token operator"},"?"),s(" url "),n("span",{class:"token operator"},":"),s(),n("span",{class:"token function"},"getLocationHref"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`

    `),n("span",{class:"token keyword"},"if"),s(),n("span",{class:"token punctuation"},"("),s("event"),n("span",{class:"token punctuation"},"."),s("exception"),n("span",{class:"token punctuation"},"."),s("values"),n("span",{class:"token punctuation"},"["),n("span",{class:"token number"},"0"),n("span",{class:"token punctuation"},"]"),n("span",{class:"token punctuation"},"."),s("stacktrace"),n("span",{class:"token punctuation"},"."),s("frames"),n("span",{class:"token punctuation"},"."),s("length "),n("span",{class:"token operator"},"==="),s(),n("span",{class:"token number"},"0"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
      event`),n("span",{class:"token punctuation"},"."),s("exception"),n("span",{class:"token punctuation"},"."),s("values"),n("span",{class:"token punctuation"},"["),n("span",{class:"token number"},"0"),n("span",{class:"token punctuation"},"]"),n("span",{class:"token punctuation"},"."),s("stacktrace"),n("span",{class:"token punctuation"},"."),s("frames"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"push"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},"{"),s(`
        colno`),n("span",{class:"token punctuation"},","),s(`
        filename`),n("span",{class:"token punctuation"},","),s(`
        `),n("span",{class:"token keyword"},"function"),n("span",{class:"token operator"},":"),s(),n("span",{class:"token string"},"'?'"),n("span",{class:"token punctuation"},","),s(`
        in_app`),n("span",{class:"token operator"},":"),s(),n("span",{class:"token boolean"},"true"),n("span",{class:"token punctuation"},","),s(`
        lineno`),n("span",{class:"token punctuation"},","),s(`
      `),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
    `),n("span",{class:"token punctuation"},"}"),s(`

    `),n("span",{class:"token keyword"},"return"),s(" event"),n("span",{class:"token punctuation"},";"),s(`
  `),n("span",{class:"token punctuation"},"}"),s(`
`)])]),n("h2",{id:"breadcrumbs-\u7684\u5B9E\u73B0",tabindex:"-1",class:"text-2xl font-bold mt-2em mb-1em next:mt-0"},[n("a",{class:"header-anchor text-sky-500 dark:text-sky-400 font-medium hover:underline",href:"#breadcrumbs-\u7684\u5B9E\u73B0","aria-hidden":"true"},"#"),s(" Breadcrumbs \u7684\u5B9E\u73B0")]),n("p",{class:"my-1.25em last:mt-0 first:mb-0 leading-[1.75]"},"\u6211\u4EEC\u77E5\u9053 Sentry \u7684\u9762\u5305\u5C51\u529F\u80FD\uFF0C\u662F\u7528\u6765\u6536\u96C6 Issue \u53D1\u751F\u65F6\u7684\u76F8\u5173\u4FE1\u606F\u3002\u901A\u8FC7 SDK \u5BF9\u67D0\u4E9B\u4E8B\u4EF6\u7684\u62E6\u622A\uFF0C\u5E76\u65F6\u523B\u8FDB\u884C\u76D1\u542C\u3002\u53EA\u8981\u5728\u62E6\u622A\u8303\u56F4\u5185\u62E6\u622A\u5230\u7528\u6237\u7684\u64CD\u4F5C\uFF0CSentry \u90FD\u4F1A\u4E3A\u5176\u751F\u6210\u4E00\u4E2A\u9762\u5305\u5C51\u8BB0\u5F55\uFF0C\u5E76\u901A\u8FC7\u5B9E\u73B0\u7684\u4E00\u4E2A\u961F\u5217\u7ED3\u6784\u6765\u5B58\u653E\u8FD9\u4E9B\u8BB0\u5F55\uFF1B\u5F53\u9519\u8BEF\u53D1\u751F\u65F6\uFF0C\u8FD9\u4E9B\u4FE1\u606F\u4F1A\u4F5C\u4E3A\u53C2\u6570\u7684\u4E00\u90E8\u5206\u4E0A\u4F20\u62A5\u544A\u5230 Sentry \u540E\u53F0\u3002"),n("p",{class:"my-1.25em last:mt-0 first:mb-0 leading-[1.75]"},[s("\u901A\u8FC7\u67E5\u770B "),n("code",null,"breadcrumbs.ts"),s(" \u6E90\u7801\uFF0C\u53D1\u73B0\u5B83\u4E3B\u8981\u662F\u5BF9 "),n("code",null,"DOM"),s(", "),n("code",null,"EventListener"),s(", "),n("code",null,"fetch"),s(", "),n("code",null,"console"),s(", "),n("code",null,"history"),s(", "),n("code",null,"xhr"),s(" \u51E0\u5904\u8FDB\u884C\u4E86\u62E6\u622A\u5904\u7406\u3002\u6240\u6709\u62E6\u622A\u4E8B\u4EF6\u4F1A\u901A\u8FC7 "),n("a",{href:"https://github.com/getsentry/sentry-javascript/blob/4905a844cef67fbd0347ee6e6f0da584f013a091/packages/browser/src/instrument.ts#L331",class:"text-sky-500 dark:text-sky-400 font-medium hover:underline",target:"_blank",rel:"noopener"},"instrument"),s("\u6765\u8FDB\u884C\u6DFB\u52A0\uFF0C")]),n("p",{class:"my-1.25em last:mt-0 first:mb-0 leading-[1.75]"},[s("\u6765\u770B\u770B "),n("code",null,"Dom"),s(" \u76F8\u5173\u7684\u5177\u4F53\u5B9E\u73B0\uFF1A")]),n("pre",{class:"language-ts"},[n("code",{class:"language-ts"},[s("  "),n("span",{class:"token comment"},`/**
   * Creates breadcrumbs from DOM API calls
   */`),s(`
  `),n("span",{class:"token keyword"},"private"),s(),n("span",{class:"token function"},"_domBreadcrumb"),n("span",{class:"token punctuation"},"("),s("handlerData"),n("span",{class:"token operator"},":"),s(),n("span",{class:"token punctuation"},"{"),s(),n("span",{class:"token punctuation"},"["),s("key"),n("span",{class:"token operator"},":"),s(),n("span",{class:"token builtin"},"string"),n("span",{class:"token punctuation"},"]"),n("span",{class:"token operator"},":"),s(),n("span",{class:"token builtin"},"any"),s(),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},")"),n("span",{class:"token operator"},":"),s(),n("span",{class:"token keyword"},"void"),s(),n("span",{class:"token punctuation"},"{"),s(`
    `),n("span",{class:"token keyword"},"let"),s(" target"),n("span",{class:"token punctuation"},";"),s(`

    `),n("span",{class:"token comment"},`/* \u8BBF\u95EE event.target\uFF0C\u5E76\u901A\u8FC7 htmlTreeAsString \u9012\u5F52\u83B7\u53D6\u7236\u8282\u70B9\uFF0C\u83B7\u53D6\u5230\u7C7B\u4F3C body > div#app > 
      img[alt="Vue logo"] \u4E4B\u7C7B\u7684\u8DEF\u5F84
     */`),s(`
    `),n("span",{class:"token keyword"},"try"),s(),n("span",{class:"token punctuation"},"{"),s(`
      target `),n("span",{class:"token operator"},"="),s(" handlerData"),n("span",{class:"token punctuation"},"."),s("event"),n("span",{class:"token punctuation"},"."),s(`target
        `),n("span",{class:"token operator"},"?"),s(),n("span",{class:"token function"},"htmlTreeAsString"),n("span",{class:"token punctuation"},"("),s("handlerData"),n("span",{class:"token punctuation"},"."),s("event"),n("span",{class:"token punctuation"},"."),s("target "),n("span",{class:"token keyword"},"as"),s(" Node"),n("span",{class:"token punctuation"},")"),s(`
        `),n("span",{class:"token operator"},":"),s(),n("span",{class:"token function"},"htmlTreeAsString"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},"("),s("handlerData"),n("span",{class:"token punctuation"},"."),s("event "),n("span",{class:"token keyword"},"as"),s(),n("span",{class:"token builtin"},"unknown"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token keyword"},"as"),s(" Node"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
    `),n("span",{class:"token punctuation"},"}"),s(),n("span",{class:"token keyword"},"catch"),s(),n("span",{class:"token punctuation"},"("),s("e"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
      target `),n("span",{class:"token operator"},"="),s(),n("span",{class:"token string"},"'<unknown>'"),n("span",{class:"token punctuation"},";"),s(`
    `),n("span",{class:"token punctuation"},"}"),s(`

    `),n("span",{class:"token keyword"},"if"),s(),n("span",{class:"token punctuation"},"("),s("target"),n("span",{class:"token punctuation"},"."),s("length "),n("span",{class:"token operator"},"==="),s(),n("span",{class:"token number"},"0"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
      `),n("span",{class:"token keyword"},"return"),n("span",{class:"token punctuation"},";"),s(`
    `),n("span",{class:"token punctuation"},"}"),s(`

    `),n("span",{class:"token function"},"getCurrentHub"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"addBreadcrumb"),n("span",{class:"token punctuation"},"("),s(`
      `),n("span",{class:"token punctuation"},"{"),s(`
        category`),n("span",{class:"token operator"},":"),s(),n("span",{class:"token template-string"},[n("span",{class:"token template-punctuation string"},"`"),n("span",{class:"token string"},"ui."),n("span",{class:"token interpolation"},[n("span",{class:"token interpolation-punctuation punctuation"},"${"),s("handlerData"),n("span",{class:"token punctuation"},"."),s("name"),n("span",{class:"token interpolation-punctuation punctuation"},"}")]),n("span",{class:"token template-punctuation string"},"`")]),n("span",{class:"token punctuation"},","),s(`
        message`),n("span",{class:"token operator"},":"),s(" target"),n("span",{class:"token punctuation"},","),s(`
      `),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},","),s(`
      `),n("span",{class:"token punctuation"},"{"),s(`
        event`),n("span",{class:"token punctuation"},","),s(`
        name`),n("span",{class:"token operator"},":"),s(" handlerData"),n("span",{class:"token punctuation"},"."),s("name"),n("span",{class:"token punctuation"},","),s(`
      `),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},","),s(`
    `),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
  `),n("span",{class:"token punctuation"},"}"),s(`
`)])]),n("p",{class:"my-1.25em last:mt-0 first:mb-0 leading-[1.75]"},"\u5173\u4E8E\u9762\u5305\u5C51\u6240\u6709\u7684\u62E6\u622A\u4E8B\u4EF6\uFF0C\u90FD\u4F1A\u6839\u636E\u6784\u9020\u51FD\u6570\u7684 options \u6765\u786E\u5B9A\u662F\u5426\u542F\u7528\uFF1A"),n("pre",{class:"language-ts"},[n("code",{class:"language-ts"},[s("  "),n("span",{class:"token keyword"},"public"),s(),n("span",{class:"token function"},"constructor"),n("span",{class:"token punctuation"},"("),s("options"),n("span",{class:"token operator"},"?"),n("span",{class:"token operator"},":"),s(" BreadcrumbIntegrations"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
    `),n("span",{class:"token keyword"},"this"),n("span",{class:"token punctuation"},"."),s("_options "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token punctuation"},"{"),s(`
      `),n("span",{class:"token builtin"},"console"),n("span",{class:"token operator"},":"),s(),n("span",{class:"token boolean"},"true"),n("span",{class:"token punctuation"},","),s(`
      dom`),n("span",{class:"token operator"},":"),s(),n("span",{class:"token boolean"},"true"),n("span",{class:"token punctuation"},","),s(`
      fetch`),n("span",{class:"token operator"},":"),s(),n("span",{class:"token boolean"},"true"),n("span",{class:"token punctuation"},","),s(`
      history`),n("span",{class:"token operator"},":"),s(),n("span",{class:"token boolean"},"true"),n("span",{class:"token punctuation"},","),s(`
      sentry`),n("span",{class:"token operator"},":"),s(),n("span",{class:"token boolean"},"true"),n("span",{class:"token punctuation"},","),s(`
      xhr`),n("span",{class:"token operator"},":"),s(),n("span",{class:"token boolean"},"true"),n("span",{class:"token punctuation"},","),s(`
      `),n("span",{class:"token operator"},"..."),s("options"),n("span",{class:"token punctuation"},","),s(`
    `),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},";"),s(`
  `),n("span",{class:"token punctuation"},"}"),s(`
`)])])],-1),f={setup(k,{expose:t}){const a={title:"Sentry \u524D\u7AEF\u5F02\u5E38\u4E0A\u62A5\u6E90\u7801\u5206\u6790",author:"\u6797\u6587\u806A",type:"post",lang:"zh-CN",date:"2019-12-08T17:56:14.000Z",description:"Sentry \u524D\u7AEF\u5F02\u5E38\u4E0A\u62A5\u6E90\u7801\u5206\u6790",image:"/images/2019/12/sentry-2.png",categories:["DevOps"],tags:["Sentry","DevOps"]};return t({frontmatter:a}),(r,i)=>{const o=e;return u(),c(o,{frontmatter:a},{default:p(()=>[l]),_:1})}}};export{f as default};
